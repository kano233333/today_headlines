<template>
  <div class="wei">
    <div v-if="data.length === 0" class="fans_list2">无</div>
    <div v-for="item in data" class="list" @click="detail(item)">
      <p>{{item.content}}</p>
      <p>{{item.readNum}}阅读数 · {{item.zanNum}}点赞数 · {{item.time}}</p>
    </div>

    <div v-infinite-scroll ="loadMore" infinite-scroll-disabled ="busy" infinite-scroll-distance="1000">
      <Loading v-if="flag && data.length !== 0" style="margin:0 auto; transform: scale(0.3)"></Loading>
    </div>
  </div>
</template>

<script>
  import Article from '../article/detail'
  import Loading from '../loading'

  export default {
    name: "wei",
    data(){
      return {
        data:[],
        busy:false,
        page:1,
        flag:true
      }
    },
    components:{
      Article,
      Loading
    },
    methods:{
      loadMore:function(){
        this.busy = true;
        let _this = this;
        setTimeout(()=> {
          _this.flag && _this.getData();
          _this.busy = false;
        },500)
      },
      detail(item){
        this.$router.push({'name':'article','params':{'id':item.id,'data':item,'type':'1','imgUrl':this.$route.params.imgUrl}})
      },
      getData(){
        let _this = this;
        this.$api.sendData('/api/getPublishList',{
          uid:this.$route.params.uid,
          page:this.page
        }).then((data)=>{
          if((data.static && data.static==0) || data.length==0){
            _this.flag = false;
            _this.busy = true;
            return;
          }
          for(let i in data){
            data[i].time = _this.$store.state.GMTToStr(data[i].time)
          }
          _this.data.push(...data);
          this.page++;
        })
      },
      flushCom(){
        this.$store.state.freshIndex = false;
        let _this = this;
        this.$nextTick(() => (_this.$store.state.freshIndex = true))
      }
    },
    created(){
      this.getData();
      this.flushCom();
    }
  }
</script>

<style scoped>
  .wei .list {
    margin:20px 20px;
    padding:10px;
    background-color: #f3f3f3;
    cursor: pointer;
    animation:0.5s Show forwards;

  }
  .wei .list >p:nth-of-type(1){
    max-height:50px;
    font-size:16px;
    line-height:1.5;
    letter-spacing: 2px;
    overflow:hidden;
    text-overflow:ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
  }
  .wei .list >p:nth-of-type(2) {
    font-size:14px;
    color:#868686;
    margin-top:20px;
  }
</style>